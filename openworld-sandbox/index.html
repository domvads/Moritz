<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Sandbox Welt</title>
<style>
    body { margin:0; overflow:hidden; }
    canvas { background:#222; display:block; margin:0 auto; }
</style>
</head>
<body>
<canvas id="game" width="800" height="600"></canvas>
<script>
// Tile-Größe und Weltgröße
const tileSize = 16;
// Startgröße der Welt (wird bei Bedarf erweitert)
let worldWidth = 200;
let worldHeight = 200;

// Lineare Kongruenzgenerator für deterministischen Zufall
function LCG(seed) {
    return function() {
        seed = Math.imul(seed, 1664525) + 1013904223 | 0;
        return ((seed >>> 0) / 4294967296);
    };
}

const seed = Date.now() & 0xffffffff; // neuer Seed bei jedem Start
const random = LCG(seed);

// Welt-Cache
// 0 = Boden, 1 = Wasser, 2 = Stein, 3 = Baum
const world = new Map();

// Pseudorandom-Zahl auf Basis der Koordinaten
function randomAt(x, y) {
    let s = Math.imul(x, 374761393) ^ Math.imul(y, 668265263) ^ seed;
    s = (s << 13) ^ s;
    return ((s >>> 0) / 4294967296);
}

// Einzelnes Tile erzeugen
function getTile(x, y) {
    const key = `${x},${y}`;
    if (world.has(key)) return world.get(key);

    let r = randomAt(x, y);
    let tile = r < 0.40 ? 1 : 0; // 40% Wasser

    if (tile === 0 && randomAt(x + 1, y + 1) < 1/15) {
        tile = randomAt(x - 1, y - 1) < 0.5 ? 2 : 3;
    }

    world.set(key, tile);
    return tile;
}

const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

let cameraX = worldWidth / 2 - canvas.width / tileSize / 2;
let cameraY = worldHeight / 2 - canvas.height / tileSize / 2;

// Kamerasteuerung
const speed = 4 / tileSize;
const keys = {};
let lookMode = false;

document.addEventListener('keydown', (e) => {
    const key = e.key.toLowerCase();
    if (key === 's' && !e.repeat) {
        lookMode = !lookMode;
    }
    keys[key] = true;
});

document.addEventListener('keyup', (e) => {
    keys[e.key.toLowerCase()] = false;
});

function update() {
    if (keys['arrowup']) cameraY -= speed;
    if (keys['arrowdown']) cameraY += speed;
    if (keys['arrowleft']) cameraX -= speed;
    if (keys['arrowright']) cameraX += speed;

    if (lookMode) {
        if (keys['w']) cameraY -= speed;
        if (keys['s']) cameraY += speed;
        if (keys['a']) cameraX -= speed;
        if (keys['d']) cameraX += speed;
    }
}

function draw() {
    update();
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    const startX = Math.floor(cameraX);
    const startY = Math.floor(cameraY);
    const tilesX = Math.ceil(canvas.width / tileSize);
    const tilesY = Math.ceil(canvas.height / tileSize);

    for (let y = 0; y <= tilesY; y++) {
        for (let x = 0; x <= tilesX; x++) {
            const mapX = startX + x;
            const mapY = startY + y;
            const tile = getTile(mapX, mapY);
            if (tile === 1) ctx.fillStyle = '#99ddee';
            else if (tile === 2) ctx.fillStyle = '#888';
            else if (tile === 3) ctx.fillStyle = '#8B4513';
            else ctx.fillStyle = '#a3d977';
            ctx.fillRect((mapX - cameraX) * tileSize, (mapY - cameraY) * tileSize, tileSize, tileSize);
        }
    }
    requestAnimationFrame(draw);
}

draw();
</script>
</body>
</html>
